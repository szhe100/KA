select 1313382.60-2599417.8 

-1286035.20

select 1978309.8-2599417.8  --  621108

 select a.rec_id,dtl_id=0,bod_id=0,a.carry_dt,bod_type_id=0,bod_type='分销采购',bod_cd=GBELN,bod_cd1=VBELN,bod_cd2='',bod_cd3=GBELN,bod_desc='',bod_desc1='',  broker_id=cast(ZSALESID_O as int),broker=ZSALESNAM_O, agent_code=a.ASSIGNED_BP,agent=case when i.rec_id>0 then dbo.fn_mate_name(i.agent_id1) else a.NAME_FIRST end,agent_id=c.mate_id,a.ASSIGNED_BP, agent1=case when i.rec_id>0 then i.agent else a.NAME_FIRST end, agent_code1=case when i.rec_id>0 then i.agent_code else a.ASSIGNED_BP end, stoppay=cast(0 as bit), a.VTEXT,a.ZKDGRP,dist1=ZZREGION, dist2=ZCITYNAME, level1=ZBEZEI, creater=ZTERNAM,dst_id=b.mate_id,mate_name=NAME1,b.mate_id,BSTKD,material_code=a.MATNR,med_code='',med_name=ARKTX,specifi=ZGG,pdt_place=ZSCQY,med_unit='',type_id1=0,bat_cd=CHARG, a.ckd_amot,ckd_amot1=e.amot,a.ckd_amot2,ckd_amot2a=d.amot,a.ckd_amot3, a.qty,price=cast(ZPR03 as decimal(15,4)),amot=cast(a.qty*cast(ZPR03 as decimal(15,4)) as decimal(15,2)),amot1=cast(a.amot1 as decimal(15,2)),amot2=cast(a.amot2 as decimal(15,2)),price1=cast(a.KONV as decimal(15,4)), price10=dbo.fn_getprice1a(ZREGIO,ZCITYNUM,a.MATNR,a.carry_dt), i.type_id,i.type_id2,i.rate,i.rate1,fee=cast(i.fee as decimal(15,4)),amot1a=cast(i.amot as decimal(15,4)),cprice1=i.price1,cprice2=i.price2,fee_type_id=0, not_amot=cast((isnull(i.amot,0)+isnull(i.fee,0))*a.qty-isnull(a.ckd_amot,0) as decimal(15,2)) ,amot5=cast(case when cast(a.KONV as decimal(15,4))=0 then 0 else cast(a.amot1/cast(a.KONV as decimal(15,4)) as decimal(15,2))*i.amot end as decimal(15,2)) from SAP_ZSD_015 a left join (select mate_id,mate_code,mate_name from tb_busimate where mate_type_id=2) b on a.NAME1=b.mate_name left join (select mate_id,mate_code,mate_name,district from tb_busimate where mate_type_id=4) c on c.mate_code=a.ASSIGNED_BP left join (select b.med_id,amot=sum(cast(b.amot as decimal(15,2))) from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.bod_id=b.bod_id group by b.med_id) d on d.med_id=a.rec_id left join (select b.med_id,amot=sum(cast(b.amot as decimal(15,2))) from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.bod_status_id=1 and a.bod_id=b.bod_id and b.type_id=0 group by b.med_id) e on e.med_id=a.rec_id left join (select c.rec_id,c.type_id,c.rate,c.rate1,c.price1,c.price2,c.type_id2,agent_id1=c.agent_id,agent_code1=f.mate_code,d.agent_id,d.amot,d.fee,agent_code=e.mate_code,agent=e.mate_name   from tb_busiframe3 c left join tb_busiframe3_dtl d on c.rec_id=d.rela_id left join tb_busimate e on d.agent_id=e.mate_id left join tb_busimate f on c.agent_id=f.mate_id) i  on i.rec_id=dbo.fn_getbusiframe3recid(a.VTWEG,a.KDGRP,b.mate_id,c.mate_id,a.MATNR,cast(a.KONV as decimal(15,4)),cast(ZPR03 as decimal(15,4)),a.carry_dt) where KDGRP not in ('10','19')  and (a.price>cast(ZPR03 as decimal(15,4)) or a.price=cast(ZPR03 as decimal(15,4)) and i.rec_id>0)  and a.carry_dt>='2025-01-01' and a.carry_dt< dateadd(day,1,'2025-07-29') and exists (select 1 from tb_busimate c where c.mate_id=17823 and (a.ASSIGNED_BP=c.mate_code or i.agent_code=c.mate_code)) 
 union all 
 select rec_id=case when h.rec_id is null then a.bod_id else h.rec_id end,dtl_id=a.bod_id,a.bod_id,a.carry_dt,a.bod_type_id,bod_type='应付记账',a.bod_cd,bod_cd1='',bod_cd2='',bod_cd3='',a.bod_desc,a.bod_desc1, a.broker_id,broker=dbo.fn_staff_name(a.broker_id),agent_code=f.mate_code,agent=f.mate_name,a.agent_id,ASSIGNED_BP=f.mate_code,agent1=f.mate_name,agent_code1=f.mate_code,stoppay=isnull(f.stoppay,0), VTEXT=dbo.fn_obj_desc1(11,a.channel_id),ZKDGRP=dbo.fn_obj_desc1(12,a.channel_dtl_id), dist1=f.BEZEI,dist2=f.CITY1,level1='', creater=d.zname,a.dst_id,e.mate_name,e.mate_id,BSTKD='',m.material_code,m.med_code,m.med_name,m.specifi,m.pdt_place,med_unit=dbo.fn_obj_desc(m.unit_id),m.type_id1,bat_cd='', z.ckd_amot,y.ckd_amot1,a.ckd_amot2,y.ckd_amot2a,h.ckd_amot3, qty=0,price=0,amot=cast(a.bod_amot as decimal(15,2)),amot1=0.00,amot2=0.00,price1=0,price10=0, type_id=0,type_id2=0,rate=0,rate1=0,fee=0,amot1a=0,cprice1=0,cprice2=0,fee_type_id=0 ,not_amot=cast(a.bod_amot-isnull(z.ckd_amot,0) as decimal(15,2)) ,amot5=cast(a.bod_amot as decimal(15,2)) from tb_bill a left join tb_bill_stadtl h on a.bod_id=h.bod_id left join tb_staff d on a.creat_by=d.sta_id left join tb_busimate e on a.dst_id=e.mate_id left join tb_busimate f on a.agent_id=f.mate_id left join tb_medicine m on a.med_id=m.med_id left join (select b.med_id,ckd_amot2a=sum(cast(b.amot as decimal(15,2))),  				ckd_amot1=sum(case a.bod_status_id when 1 then 1 else 0 end*cast(b.amot as decimal(15,2))) 			  from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.carry_dt>='2025-01-01' and a.bod_id=b.bod_id and b.type_id=36 group by b.med_id) y on y.med_id=a.bod_id left join (select b.med_id,ckd_amot =sum(cast(b.amot as decimal(15,2))) 			  from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.carry_dt>='2025-01-01' and a.bod_id=b.bod_id and b.type_id=36 				and exists (select 1 from tb_bill c,tb_bill_dtl d where c.bod_type_id=30 and c.bod_status_id=1 and c.bod_id=d.bod_id and d.med_id=a.bod_id)	group by b.med_id) z on z.med_id=a.bod_id where a.bod_type_id=36 and a.bod_status_id=1  and a.carry_dt>='2025-01-01' and a.carry_dt< dateadd(day,1,'2025-07-29') and a.agent_id=17823

 select a.rec_id,dtl_id=0,bod_id=0,a.carry_dt,bod_type_id=0,bod_type='分销采购',bod_cd=GBELN,bod_cd1=VBELN,bod_cd2='',bod_cd3=GBELN,bod_desc='',bod_desc1='',  broker_id=cast(ZSALESID_O as int),broker=ZSALESNAM_O, agent_code=a.ASSIGNED_BP,agent=case when i.rec_id>0 then dbo.fn_mate_name(i.agent_id1) else a.NAME_FIRST end,agent_id=c.mate_id,a.ASSIGNED_BP, agent1=case when i.rec_id>0 then i.agent else a.NAME_FIRST end, agent_code1=case when i.rec_id>0 then i.agent_code else a.ASSIGNED_BP end, stoppay=cast(0 as bit), a.VTEXT,a.ZKDGRP,dist1=ZZREGION, dist2=ZCITYNAME, level1=ZBEZEI, creater=ZTERNAM,dst_id=b.mate_id,mate_name=NAME1,b.mate_id,BSTKD,material_code=a.MATNR,med_code='',med_name=ARKTX,specifi=ZGG,pdt_place=ZSCQY,med_unit='',type_id1=0,bat_cd=CHARG, a.ckd_amot,ckd_amot1=e.amot,a.ckd_amot2,ckd_amot2a=d.amot,a.ckd_amot3, a.qty,price=cast(ZPR03 as decimal(15,4)),amot=cast(a.qty*cast(ZPR03 as decimal(15,4)) as decimal(15,2)),amot1=cast(a.amot1 as decimal(15,2)),amot2=cast(a.amot2 as decimal(15,2)),price1=cast(a.KONV as decimal(15,4)), price10=dbo.fn_getprice1a(ZREGIO,ZCITYNUM,a.MATNR,a.carry_dt), i.type_id,i.type_id2,i.rate,i.rate1,fee=cast(i.fee as decimal(15,4)),amot1a=cast(i.amot as decimal(15,4)),cprice1=i.price1,cprice2=i.price2,fee_type_id=0, not_amot=cast((isnull(i.amot,0)+isnull(i.fee,0))*a.qty-isnull(a.ckd_amot,0) as decimal(15,2)) ,amot5=cast(case when cast(a.KONV as decimal(15,4))=0 then 0 else cast(a.amot1/cast(a.KONV as decimal(15,4)) as decimal(15,2))*i.amot end as decimal(15,2)) 
 from SAP_ZSD_015 a 
 left join (select mate_id,mate_code,mate_name from tb_busimate where mate_type_id=2) b on a.NAME1=b.mate_name 
 left join (select mate_id,mate_code,mate_name,district from tb_busimate where mate_type_id=4) c on c.mate_code=a.ASSIGNED_BP 
 left join (select b.med_id,amot=sum(cast(b.amot as decimal(15,2))) from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.bod_id=b.bod_id group by b.med_id) d on d.med_id=a.rec_id 
 left join (select b.med_id,amot=sum(cast(b.amot as decimal(15,2))) from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.bod_status_id=1 and a.bod_id=b.bod_id and b.type_id=0 group by b.med_id) e on e.med_id=a.rec_id 
 left join (select c.rec_id,c.type_id,c.rate,c.rate1,c.price1,c.price2,c.type_id2,agent_id1=c.agent_id,agent_code1=f.mate_code,d.agent_id,d.amot,d.fee,agent_code=e.mate_code,agent=e.mate_name   from tb_busiframe3 c left join tb_busiframe3_dtl d on c.rec_id=d.rela_id 
 left join tb_busimate e on d.agent_id=e.mate_id left join tb_busimate f on c.agent_id=f.mate_id) i  on i.rec_id=dbo.fn_getbusiframe3recid(a.VTWEG,a.KDGRP,b.mate_id,c.mate_id,a.MATNR,cast(a.KONV as decimal(15,4)),cast(ZPR03 as decimal(15,4)),a.carry_dt) 
 where KDGRP not in ('10','19')  and (a.price>cast(ZPR03 as decimal(15,4)) or a.price=cast(ZPR03 as decimal(15,4)) and i.rec_id>0)  
 and a.carry_dt>='2025-01-01' and a.carry_dt< dateadd(day,1,'2025-07-29') 
 and exists (select 1 from tb_busimate c where c.mate_id=17823 and (a.ASSIGNED_BP=c.mate_code or i.agent_code=c.mate_code)) 



 select a.rec_id,dtl_id=0,bod_id=0,a.carry_dt,bod_type_id=0,bod_type='分销采购',bod_cd=GBELN,bod_cd1=VBELN,bod_cd2='',bod_cd3=GBELN,bod_desc='',bod_desc1='',  broker_id=cast(ZSALESID_O as int),broker=ZSALESNAM_O, agent_code=a.ASSIGNED_BP,agent=case when i.rec_id>0 then dbo.fn_mate_name(i.agent_id1) else a.NAME_FIRST end,agent_id=c.mate_id,a.ASSIGNED_BP, agent1=case when i.rec_id>0 then i.agent else a.NAME_FIRST end, agent_code1=case when i.rec_id>0 then i.agent_code else a.ASSIGNED_BP end, stoppay=cast(0 as bit), a.VTEXT,a.ZKDGRP,dist1=ZZREGION, dist2=ZCITYNAME, level1=ZBEZEI, creater=ZTERNAM,dst_id=b.mate_id,mate_name=NAME1,b.mate_id,BSTKD,material_code=a.MATNR,med_code='',med_name=ARKTX,specifi=ZGG,pdt_place=ZSCQY,med_unit='',type_id1=0,bat_cd=CHARG, 
 a.ckd_amot,ckd_amot1=e.amot,a.ckd_amot2,ckd_amot2a=d.amot,a.ckd_amot3, 
 a.qty,price=cast(ZPR03 as decimal(15,4)),
 amot=cast(a.qty*cast(ZPR03 as decimal(15,4)) as decimal(15,2)),amot1=cast(a.amot1 as decimal(15,2)),amot2=cast(a.amot2 as decimal(15,2)),price1=cast(a.KONV as decimal(15,4)), 
 price10=dbo.fn_getprice1a(ZREGIO,ZCITYNUM,a.MATNR,a.carry_dt), 
 i.type_id,i.type_id2,i.rate,i.rate1,
 fee=cast(i.fee as decimal(15,4)),amot1a=cast(i.amot as decimal(15,4)),
 cprice1=i.price1,cprice2=i.price2,fee_type_id=0, 
 not_amot=cast((isnull(i.amot,0)+isnull(i.fee,0))*a.qty-isnull(a.ckd_amot,0) as decimal(15,2)) ,
 amot5=cast(case when cast(a.KONV as decimal(15,4))=0 then 0 else cast(a.amot1/cast(a.KONV as decimal(15,4)) as decimal(15,2))*i.amot end as decimal(15,2)) 
 from SAP_ZSD_015 a 
 left join (select mate_id,mate_code,mate_name from tb_busimate where mate_type_id=2) b on a.NAME1=b.mate_name 
 left join (select mate_id,mate_code,mate_name,district from tb_busimate where mate_type_id=4) c on c.mate_code=a.ASSIGNED_BP 
 left join (select b.med_id,amot=sum(cast(b.amot as decimal(15,2))) from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.bod_id=b.bod_id group by b.med_id) d on d.med_id=a.rec_id 
 left join (select b.med_id,amot=sum(cast(b.amot as decimal(15,2))) from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.bod_status_id=1 and a.bod_id=b.bod_id and b.type_id=0 group by b.med_id) e on e.med_id=a.rec_id 
 left join (select c.rec_id,c.type_id,c.rate,c.rate1,c.price1,c.price2,c.type_id2,agent_id1=c.agent_id,agent_code1=f.mate_code,d.agent_id,d.amot,d.fee,agent_code=e.mate_code,agent=e.mate_name   from tb_busiframe3 c left join tb_busiframe3_dtl d on c.rec_id=d.rela_id 
 left join tb_busimate e on d.agent_id=e.mate_id left join tb_busimate f on c.agent_id=f.mate_id) i  on i.rec_id=dbo.fn_getbusiframe3recid(a.VTWEG,a.KDGRP,b.mate_id,c.mate_id,a.MATNR,cast(a.KONV as decimal(15,4)),cast(ZPR03 as decimal(15,4)),a.carry_dt) 
 where KDGRP not in ('10','19')  and (a.price>cast(ZPR03 as decimal(15,4)) or a.price=cast(ZPR03 as decimal(15,4)) and i.rec_id>0)  
 and a.carry_dt>='2025-01-01' and a.carry_dt< dateadd(day,1,'2025-07-29') 
 and exists (select 1 from tb_busimate c where c.mate_id=17823 and (a.ASSIGNED_BP=c.mate_code or i.agent_code=c.mate_code)) 


 select len('新疆维吾尔自治区人民医院（新疆维吾尔自治区高血压病研究所、新疆维吾尔自治区急救医学研究所、新疆维吾尔自治区临床药学研究所、新疆维吾尔自治区临床营养研究所、新疆维吾尔自治区临床皮肤性病研究所、新疆维吾尔自治区普通外科微创研究所、新疆维吾尔自治区内分泌糖尿病研究所）')

select len('新疆维吾尔自治区人民医院（新疆维吾尔自治区高血压病研究所、新疆维吾尔自治区急救医学研究所、新疆维吾尔')

select * from tb_busimate where mate_code='576643'

update tb_busimate set mate_name='新疆维吾尔自治区人民医院（新疆维吾尔自治区高血压病研究所、新疆维吾尔自治区急救医学研究所、新疆维吾尔自治区临床药学研究所、新疆维吾尔自治区临床营养研究所、新疆维吾尔自治区临床皮肤性病研究所、新疆维吾尔自治区普通外科微创研究所、新疆维吾尔自治区内分泌糖尿病研究所）' where mate_id=31595

alter table tb_busimate alter column mate_name varchar(300)

select * into tb_busimate_250731 from tb_busimate

select * from (
select * from tb_busimate
) a where mate_code in ('576643')


  select a.rec_id,dtl_id=0,bod_id=0,a.carry_dt,bod_type_id=0,bod_type='分销采购',bod_cd=GBELN,bod_cd1=VBELN,bod_cd2='',bod_cd3=GBELN,bod_desc='',bod_desc1='',  broker_id=cast(ZSALESID_O as int),broker=ZSALESNAM_O, agent_code=a.ASSIGNED_BP,agent=case when i.rec_id>0 then dbo.fn_mate_name(i.agent_id1) else a.NAME_FIRST end,agent_id=c.mate_id,a.ASSIGNED_BP, agent1=case when i.rec_id>0 then i.agent else a.NAME_FIRST end, agent_code1=case when i.rec_id>0 then i.agent_code else a.ASSIGNED_BP end, stoppay=cast(0 as bit), a.VTEXT,a.ZKDGRP,dist1=ZZREGION, dist2=ZCITYNAME, level1=ZBEZEI, creater=ZTERNAM,dst_id=b.mate_id,mate_name=NAME1,b.mate_id,BSTKD,material_code=a.MATNR,med_code='',med_name=ARKTX,specifi=ZGG,pdt_place=ZSCQY,med_unit='',type_id1=0,bat_cd=CHARG, a.ckd_amot,ckd_amot1=e.amot,a.ckd_amot2,ckd_amot2a=d.amot,a.ckd_amot3, a.qty,price=cast(ZPR03 as decimal(15,4)),amot=cast(a.qty*cast(ZPR03 as decimal(15,4)) as decimal(15,2)),amot1=cast(a.amot1 as decimal(15,2)),amot2=cast(a.amot2 as decimal(15,2)),price1=cast(a.KONV as decimal(15,4)), price10=dbo.fn_getprice1a(ZREGIO,ZCITYNUM,a.MATNR,a.carry_dt), i.type_id,i.type_id2,i.rate,i.rate1,fee=cast(i.fee as decimal(15,4)),amot1a=cast(i.amot as decimal(15,4)),cprice1=i.price1,cprice2=i.price2,fee_type_id=0, not_amot=cast((isnull(i.amot,0)+isnull(i.fee,0))*a.qty-isnull(a.ckd_amot,0) as decimal(15,2)) ,amot5=cast(case when cast(a.KONV as decimal(15,4))=0 then 0 else cast(a.amot1/cast(a.KONV as decimal(15,4)) as decimal(15,2))*i.amot end as decimal(15,2)) from SAP_ZSD_015 a left join (select mate_id,mate_code,mate_name from tb_busimate where mate_type_id=2) b on a.NAME1=b.mate_name left join (select mate_id,mate_code,mate_name,district from tb_busimate where mate_type_id=4) c on c.mate_code=a.ASSIGNED_BP left join (select b.med_id,amot=sum(cast(b.amot as decimal(15,2))) from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.bod_id=b.bod_id group by b.med_id) d on d.med_id=a.rec_id left join (select b.med_id,amot=sum(cast(b.amot as decimal(15,2))) from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.bod_status_id=1 and a.bod_id=b.bod_id and b.type_id=0 group by b.med_id) e on e.med_id=a.rec_id left join (select c.rec_id,c.type_id,c.rate,c.rate1,c.price1,c.price2,c.type_id2,agent_id1=c.agent_id,agent_code1=f.mate_code,d.agent_id,d.amot,d.fee,agent_code=e.mate_code,agent=e.mate_name   from tb_busiframe3 c left join tb_busiframe3_dtl d on c.rec_id=d.rela_id left join tb_busimate e on d.agent_id=e.mate_id left join tb_busimate f on c.agent_id=f.mate_id) i  on i.rec_id=dbo.fn_getbusiframe3recid(a.VTWEG,a.KDGRP,b.mate_id,c.mate_id,a.MATNR,cast(a.KONV as decimal(15,4)),cast(ZPR03 as decimal(15,4)),a.carry_dt) where KDGRP not in ('10','19')  and (a.price>cast(ZPR03 as decimal(15,4)) or a.price=cast(ZPR03 as decimal(15,4)) and i.rec_id>0)  and a.carry_dt>='2025-07-01' and a.carry_dt< dateadd(day,1,'2025-08-01') union all select rec_id=case when h.rec_id is null then a.bod_id else h.rec_id end,dtl_id=a.bod_id,a.bod_id,a.carry_dt,a.bod_type_id,bod_type='应付记账',a.bod_cd,bod_cd1='',bod_cd2='',bod_cd3='',a.bod_desc,a.bod_desc1, a.broker_id,broker=dbo.fn_staff_name(a.broker_id),agent_code=f.mate_code,agent=f.mate_name,a.agent_id,ASSIGNED_BP=f.mate_code,agent1=f.mate_name,agent_code1=f.mate_code,stoppay=isnull(f.stoppay,0), VTEXT=dbo.fn_obj_desc1(11,a.channel_id),ZKDGRP=dbo.fn_obj_desc1(12,a.channel_dtl_id), dist1=f.BEZEI,dist2=f.CITY1,level1='', creater=d.zname,a.dst_id,e.mate_name,e.mate_id,BSTKD='',m.material_code,m.med_code,m.med_name,m.specifi,m.pdt_place,med_unit=dbo.fn_obj_desc(m.unit_id),m.type_id1,bat_cd='', z.ckd_amot,y.ckd_amot1,a.ckd_amot2,y.ckd_amot2a,h.ckd_amot3, qty=0,price=0,amot=cast(a.bod_amot as decimal(15,2)),amot1=0.00,amot2=0.00,price1=0,price10=0, type_id=0,type_id2=0,rate=0,rate1=0,fee=0,amot1a=0,cprice1=0,cprice2=0,fee_type_id=0 ,not_amot=cast(a.bod_amot-isnull(z.ckd_amot,0) as decimal(15,2)) ,amot5=cast(a.bod_amot as decimal(15,2)) from tb_bill a left join tb_bill_stadtl h on a.bod_id=h.bod_id left join tb_staff d on a.creat_by=d.sta_id left join tb_busimate e on a.dst_id=e.mate_id left join tb_busimate f on a.agent_id=f.mate_id left join tb_medicine m on a.med_id=m.med_id left join (select b.med_id,ckd_amot2a=sum(cast(b.amot as decimal(15,2))),  				ckd_amot1=sum(case a.bod_status_id when 1 then 1 else 0 end*cast(b.amot as decimal(15,2))) 			  from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.carry_dt>='2025-07-01' and a.bod_id=b.bod_id and b.type_id=36 group by b.med_id) y on y.med_id=a.bod_id left join (select b.med_id,ckd_amot =sum(cast(b.amot as decimal(15,2))) 			  from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.carry_dt>='2025-07-01' and a.bod_id=b.bod_id and b.type_id=36 				and exists (select 1 from tb_bill c,tb_bill_dtl d where c.bod_type_id=30 and c.bod_status_id=1 and c.bod_id=d.bod_id and d.med_id=a.bod_id)	group by b.med_id) z on z.med_id=a.bod_id where a.bod_type_id=36 and a.bod_status_id=1  and a.carry_dt>='2025-07-01' and a.carry_dt< dateadd(day,1,'2025-08-01')


  select * from (  select a.rec_id,dtl_id=0,bod_id=0,a.carry_dt,bod_type_id=0,bod_type='分销采购',bod_cd=GBELN,bod_cd1=VBELN,bod_cd2='',bod_cd3=GBELN,bod_desc='',bod_desc1='',  broker_id=cast(ZSALESID_O as int),broker=ZSALESNAM_O, agent_code=a.ASSIGNED_BP,agent=case when i.rec_id>0 then dbo.fn_mate_name(i.agent_id1) else a.NAME_FIRST end,agent_id=c.mate_id,a.ASSIGNED_BP, agent1=case when i.rec_id>0 then i.agent else a.NAME_FIRST end, agent_code1=case when i.rec_id>0 then i.agent_code else a.ASSIGNED_BP end, stoppay=cast(0 as bit), a.VTEXT,a.ZKDGRP,dist1=ZZREGION, dist2=ZCITYNAME, level1=ZBEZEI, creater=ZTERNAM,dst_id=b.mate_id,mate_name=NAME1,b.mate_id,BSTKD,material_code=a.MATNR,med_code='',med_name=ARKTX,specifi=ZGG,pdt_place=ZSCQY,med_unit='',type_id1=0,bat_cd=CHARG, a.ckd_amot,ckd_amot1=e.amot,a.ckd_amot2,ckd_amot2a=d.amot,a.ckd_amot3, a.qty,price=cast(ZPR03 as decimal(15,4)),amot=cast(a.qty*cast(ZPR03 as decimal(15,4)) as decimal(15,2)),amot1=cast(a.amot1 as decimal(15,2)),amot2=cast(a.amot2 as decimal(15,2)),price1=cast(a.KONV as decimal(15,4)), price10=dbo.fn_getprice1a(ZREGIO,ZCITYNUM,a.MATNR,a.carry_dt), i.type_id,i.type_id2,i.rate,i.rate1,fee=cast(i.fee as decimal(15,4)),amot1a=cast(i.amot as decimal(15,4)),cprice1=i.price1,cprice2=i.price2,fee_type_id=0, not_amot=cast((isnull(i.amot,0)+isnull(i.fee,0))*a.qty-isnull(a.ckd_amot,0) as decimal(15,2)) ,amot5=cast(case when cast(a.KONV as decimal(15,4))=0 then 0 else cast(a.amot1/cast(a.KONV as decimal(15,4)) as decimal(15,2))*i.amot end as decimal(15,2)) from SAP_ZSD_015 a left join (select mate_id,mate_code,mate_name from tb_busimate where mate_type_id=2) b on a.NAME1=b.mate_name left join (select mate_id,mate_code,mate_name,district from tb_busimate where mate_type_id=4) c on c.mate_code=a.ASSIGNED_BP left join (select b.med_id,amot=sum(cast(b.amot as decimal(15,2))) from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.bod_id=b.bod_id group by b.med_id) d on d.med_id=a.rec_id left join (select b.med_id,amot=sum(cast(b.amot as decimal(15,2))) from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.bod_status_id=1 and a.bod_id=b.bod_id and b.type_id=0 group by b.med_id) e on e.med_id=a.rec_id left join (select c.rec_id,c.type_id,c.rate,c.rate1,c.price1,c.price2,c.type_id2,agent_id1=c.agent_id,agent_code1=f.mate_code,d.agent_id,d.amot,d.fee,agent_code=e.mate_code,agent=e.mate_name   from tb_busiframe3 c left join tb_busiframe3_dtl d on c.rec_id=d.rela_id left join tb_busimate e on d.agent_id=e.mate_id left join tb_busimate f on c.agent_id=f.mate_id) i  on i.rec_id=dbo.fn_getbusiframe3recid(a.VTWEG,a.KDGRP,b.mate_id,c.mate_id,a.MATNR,cast(a.KONV as decimal(15,4)),cast(ZPR03 as decimal(15,4)),a.carry_dt) where KDGRP not in ('10','19')  and (a.price>cast(ZPR03 as decimal(15,4)) or a.price=cast(ZPR03 as decimal(15,4)) and i.rec_id>0)  and a.carry_dt>='2025-07-01' and a.carry_dt< dateadd(day,1,'2025-08-01') union all select rec_id=case when h.rec_id is null then a.bod_id else h.rec_id end,dtl_id=a.bod_id,a.bod_id,a.carry_dt,a.bod_type_id,bod_type='应付记账',a.bod_cd,bod_cd1='',bod_cd2='',bod_cd3='',a.bod_desc,a.bod_desc1, a.broker_id,broker=dbo.fn_staff_name(a.broker_id),agent_code=f.mate_code,agent=f.mate_name,a.agent_id,ASSIGNED_BP=f.mate_code,agent1=f.mate_name,agent_code1=f.mate_code,stoppay=isnull(f.stoppay,0), VTEXT=dbo.fn_obj_desc1(11,a.channel_id),ZKDGRP=dbo.fn_obj_desc1(12,a.channel_dtl_id), dist1=f.BEZEI,dist2=f.CITY1,level1='', creater=d.zname,a.dst_id,e.mate_name,e.mate_id,BSTKD='',m.material_code,m.med_code,m.med_name,m.specifi,m.pdt_place,med_unit=dbo.fn_obj_desc(m.unit_id),m.type_id1,bat_cd='', z.ckd_amot,y.ckd_amot1,a.ckd_amot2,y.ckd_amot2a,h.ckd_amot3, qty=0,price=0,amot=cast(a.bod_amot as decimal(15,2)),amot1=0.00,amot2=0.00,price1=0,price10=0, type_id=0,type_id2=0,rate=0,rate1=0,fee=0,amot1a=0,cprice1=0,cprice2=0,fee_type_id=0 ,not_amot=cast(a.bod_amot-isnull(z.ckd_amot,0) as decimal(15,2)) ,amot5=cast(a.bod_amot as decimal(15,2)) from tb_bill a left join tb_bill_stadtl h on a.bod_id=h.bod_id left join tb_staff d on a.creat_by=d.sta_id left join tb_busimate e on a.dst_id=e.mate_id left join tb_busimate f on a.agent_id=f.mate_id left join tb_medicine m on a.med_id=m.med_id left join (select b.med_id,ckd_amot2a=sum(cast(b.amot as decimal(15,2))),  				ckd_amot1=sum(case a.bod_status_id when 1 then 1 else 0 end*cast(b.amot as decimal(15,2))) 			  from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.carry_dt>='2025-07-01' and a.bod_id=b.bod_id and b.type_id=36 group by b.med_id) y on y.med_id=a.bod_id left join (select b.med_id,ckd_amot =sum(cast(b.amot as decimal(15,2))) 			  from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.carry_dt>='2025-07-01' and a.bod_id=b.bod_id and b.type_id=36 				and exists (select 1 from tb_bill c,tb_bill_dtl d where c.bod_type_id=30 and c.bod_status_id=1 and c.bod_id=d.bod_id and d.med_id=a.bod_id)	group by b.med_id) z on z.med_id=a.bod_id where a.bod_type_id=36 and a.bod_status_id=1  and a.carry_dt>='2025-07-01' and a.carry_dt< dateadd(day,1,'2025-08-01') ) a where dist2 in ('大连市')
  
  select sta_id,zname,receiver,bank_name,depo_acco from tb_staff a where a.sta_type_id=1
update tb_staff set receiver=null,bank_name=null,depo_acco=null,indi_acco=null where sta_type_id=1

  select * into tb_staff_250801 from tb_staff

 select a.rec_id,dtl_id=0,bod_id=0,a.carry_dt,bod_type_id=0,bod_type='分销采购',bod_cd=GBELN,bod_cd1=VBELN,bod_cd2='',bod_cd3=GBELN,bod_desc='',bod_desc1='',  broker_id=cast(ZSALESID_O as int),broker=ZSALESNAM_O, agent_code=a.ASSIGNED_BP,agent=case when i.rec_id>0 then dbo.fn_mate_name(i.agent_id1) else a.NAME_FIRST end,agent_id=c.mate_id,a.ASSIGNED_BP, agent1=case when i.rec_id>0 then i.agent else a.NAME_FIRST end, agent_code1=case when i.rec_id>0 then i.agent_code else a.ASSIGNED_BP end, stoppay=cast(0 as bit), a.VTEXT,a.ZKDGRP,dist1=ZZREGION, dist2=ZCITYNAME, level1=ZBEZEI, creater=ZTERNAM,dst_id=b.mate_id,mate_name=NAME1,b.mate_id,BSTKD,material_code=a.MATNR,med_code='',med_name=ARKTX,specifi=ZGG,pdt_place=ZSCQY,med_unit='',type_id1=0,bat_cd=CHARG, a.ckd_amot,ckd_amot1=e.amot,a.ckd_amot2,ckd_amot2a=d.amot,a.ckd_amot3, a.qty,price=cast(ZPR03 as decimal(15,4)),amot=cast(a.qty*cast(ZPR03 as decimal(15,4)) as decimal(15,2)),amot1=cast(a.amot1 as decimal(15,2)),amot2=cast(a.amot2 as decimal(15,2)),price1=cast(a.KONV as decimal(15,4)), price10=dbo.fn_getprice1a(ZREGIO,ZCITYNUM,a.MATNR,a.carry_dt), i.type_id,i.type_id2,i.rate,i.rate1,fee=cast(i.fee as decimal(15,4)),amot1a=cast(i.amot as decimal(15,4)),cprice1=i.price1,cprice2=i.price2,fee_type_id=0, not_amot=cast((isnull(i.amot,0)+isnull(i.fee,0))*a.qty-isnull(a.ckd_amot,0) as decimal(15,2)) ,amot5=cast(case when cast(a.KONV as decimal(15,4))=0 then 0 else cast(a.amot1/cast(a.KONV as decimal(15,4)) as decimal(15,2))*i.amot end as decimal(15,2)) from SAP_ZSD_015 a left join (select mate_id,mate_code,mate_name from tb_busimate where mate_type_id=2) b on a.NAME1=b.mate_name left join (select mate_id,mate_code,mate_name,district from tb_busimate where mate_type_id=4) c on c.mate_code=a.ASSIGNED_BP left join (select b.med_id,amot=sum(cast(b.amot as decimal(15,2))) from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.bod_id=b.bod_id group by b.med_id) d on d.med_id=a.rec_id left join (select b.med_id,amot=sum(cast(b.amot as decimal(15,2))) from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.bod_status_id=1 and a.bod_id=b.bod_id and b.type_id=0 group by b.med_id) e on e.med_id=a.rec_id left join (select c.rec_id,c.type_id,c.rate,c.rate1,c.price1,c.price2,c.type_id2,agent_id1=c.agent_id,agent_code1=f.mate_code,d.agent_id,d.amot,d.fee,agent_code=e.mate_code,agent=e.mate_name   from tb_busiframe3 c left join tb_busiframe3_dtl d on c.rec_id=d.rela_id left join tb_busimate e on d.agent_id=e.mate_id left join tb_busimate f on c.agent_id=f.mate_id) i  on i.rec_id=dbo.fn_getbusiframe3recid(a.VTWEG,a.KDGRP,b.mate_id,c.mate_id,a.MATNR,cast(a.KONV as decimal(15,4)),cast(ZPR03 as decimal(15,4)),a.carry_dt) where KDGRP not in ('10','19')  and (a.price>cast(ZPR03 as decimal(15,4)) or a.price=cast(ZPR03 as decimal(15,4)) and i.rec_id>0)  and a.carry_dt>='2025-07-01' and a.carry_dt< dateadd(day,1,'2025-08-01') union all select rec_id=case when h.rec_id is null then a.bod_id else h.rec_id end,dtl_id=a.bod_id,a.bod_id,a.carry_dt,a.bod_type_id,bod_type='应付记账',a.bod_cd,bod_cd1='',bod_cd2='',bod_cd3='',a.bod_desc,a.bod_desc1, a.broker_id,broker=dbo.fn_staff_name(a.broker_id),agent_code=f.mate_code,agent=f.mate_name,a.agent_id,ASSIGNED_BP=f.mate_code,agent1=f.mate_name,agent_code1=f.mate_code,stoppay=isnull(f.stoppay,0), VTEXT=dbo.fn_obj_desc1(11,a.channel_id),ZKDGRP=dbo.fn_obj_desc1(12,a.channel_dtl_id), dist1=f.BEZEI,dist2=f.CITY1,level1='', creater=d.zname,a.dst_id,e.mate_name,e.mate_id,BSTKD='',m.material_code,m.med_code,m.med_name,m.specifi,m.pdt_place,med_unit=dbo.fn_obj_desc(m.unit_id),m.type_id1,bat_cd='', z.ckd_amot,y.ckd_amot1,a.ckd_amot2,y.ckd_amot2a,h.ckd_amot3, qty=0,price=0,amot=cast(a.bod_amot as decimal(15,2)),amot1=0.00,amot2=0.00,price1=0,price10=0, type_id=0,type_id2=0,rate=0,rate1=0,fee=0,amot1a=0,cprice1=0,cprice2=0,fee_type_id=0 ,not_amot=cast(a.bod_amot-isnull(z.ckd_amot,0) as decimal(15,2)) ,amot5=cast(a.bod_amot as decimal(15,2)) from tb_bill a left join tb_bill_stadtl h on a.bod_id=h.bod_id left join tb_staff d on a.creat_by=d.sta_id left join tb_busimate e on a.dst_id=e.mate_id left join tb_busimate f on a.agent_id=f.mate_id left join tb_medicine m on a.med_id=m.med_id left join (select b.med_id,ckd_amot2a=sum(cast(b.amot as decimal(15,2))),  				ckd_amot1=sum(case a.bod_status_id when 1 then 1 else 0 end*cast(b.amot as decimal(15,2))) 			  from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.carry_dt>='2025-07-01' and a.bod_id=b.bod_id and b.type_id=36 group by b.med_id) y on y.med_id=a.bod_id left join (select b.med_id,ckd_amot =sum(cast(b.amot as decimal(15,2))) 			  from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.carry_dt>='2025-07-01' and a.bod_id=b.bod_id and b.type_id=36 				and exists (select 1 from tb_bill c,tb_bill_dtl d where c.bod_type_id=30 and c.bod_status_id=1 and c.bod_id=d.bod_id and d.med_id=a.bod_id)	group by b.med_id) z on z.med_id=a.bod_id where a.bod_type_id=36 and a.bod_status_id=1  and a.carry_dt>='2025-07-01' and a.carry_dt< dateadd(day,1,'2025-08-01')

  select a.rec_id,dtl_id=0,bod_id=0,a.carry_dt,bod_type_id=0,bod_type='·ÖÏú²É¹º',bod_cd=GBELN,bod_cd1=VBELN,bod_cd2='',bod_cd3=GBELN,bod_desc='',bod_desc1='',  broker_id=cast(ZSALESID_O as int),broker=ZSALESNAM_O, agent_code=a.ASSIGNED_BP,agent=case when i.rec_id>0 then dbo.fn_mate_name(i.agent_id1) else a.NAME_FIRST end,agent_id=c.mate_id,a.ASSIGNED_BP, agent1=case when i.rec_id>0 then i.agent else a.NAME_FIRST end, agent_code1=case when i.rec_id>0 then i.agent_code else a.ASSIGNED_BP end, stoppay=cast(0 as bit), a.VTEXT,a.ZKDGRP,dist1=ZZREGION, dist2=ZCITYNAME, level1=ZBEZEI, creater=ZTERNAM,dst_id=b.mate_id,mate_name=NAME1,b.mate_id,BSTKD,material_code=a.MATNR,med_code='',med_name=ARKTX,specifi=ZGG,pdt_place=ZSCQY,med_unit='',type_id1=0,bat_cd=CHARG, a.ckd_amot,ckd_amot1=e.amot,a.ckd_amot2,ckd_amot2a=d.amot,a.ckd_amot3, a.qty,price=cast(ZPR03 as decimal(15,4)),amot=cast(a.qty*cast(ZPR03 as decimal(15,4)) as decimal(15,2)),amot1=cast(a.amot1 as decimal(15,2)),amot2=cast(a.amot2 as decimal(15,2)),price1=cast(a.KONV as decimal(15,4)), price10=dbo.fn_getprice1a(ZREGIO,ZCITYNUM,a.MATNR,a.carry_dt), i.type_id,i.type_id2,i.rate,i.rate1,fee=cast(i.fee as decimal(15,4)),amot1a=cast(i.amot as decimal(15,4)),cprice1=i.price1,cprice2=i.price2,fee_type_id=0, not_amot=cast((isnull(i.amot,0)+isnull(i.fee,0))*a.qty-isnull(a.ckd_amot,0) as decimal(15,2)) ,amot5=cast(case when cast(a.KONV as decimal(15,4))=0 then 0 else cast(a.amot1/cast(a.KONV as decimal(15,4)) as decimal(15,2))*i.amot end as decimal(15,2)) from SAP_ZSD_015 a left join (select mate_id,mate_code,mate_name from tb_busimate where mate_type_id=2) b on a.NAME1=b.mate_name left join (select mate_id,mate_code,mate_name,district from tb_busimate where mate_type_id=4) c on c.mate_code=a.ASSIGNED_BP left join (select b.med_id,amot=sum(cast(b.amot as decimal(15,2))) from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.bod_id=b.bod_id group by b.med_id) d on d.med_id=a.rec_id left join (select b.med_id,amot=sum(cast(b.amot as decimal(15,2))) from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.bod_status_id=1 and a.bod_id=b.bod_id and b.type_id=0 group by b.med_id) e on e.med_id=a.rec_id left join (select c.rec_id,c.type_id,c.rate,c.rate1,c.price1,c.price2,c.type_id2,agent_id1=c.agent_id,agent_code1=f.mate_code,d.agent_id,d.amot,d.fee,agent_code=e.mate_code,agent=e.mate_name   from tb_busiframe3 c left join tb_busiframe3_dtl d on c.rec_id=d.rela_id left join tb_busimate e on d.agent_id=e.mate_id left join tb_busimate f on c.agent_id=f.mate_id) i  on i.rec_id=dbo.fn_getbusiframe3recid(a.VTWEG,a.KDGRP,b.mate_id,c.mate_id,a.MATNR,cast(a.KONV as decimal(15,4)),cast(ZPR03 as decimal(15,4)),a.carry_dt) where KDGRP not in ('10','19')  and (a.price>cast(ZPR03 as decimal(15,4)) or a.price=cast(ZPR03 as decimal(15,4)) and i.rec_id>0)  and a.carry_dt>='2025-07-01' and a.carry_dt< dateadd(day,1,'2025-08-01') union all select rec_id=case when h.rec_id is null then a.bod_id else h.rec_id end,dtl_id=a.bod_id,a.bod_id,a.carry_dt,a.bod_type_id,bod_type='Ó¦¸¶¼ÇÕË',a.bod_cd,bod_cd1='',bod_cd2='',bod_cd3='',a.bod_desc,a.bod_desc1, a.broker_id,broker=dbo.fn_staff_name(a.broker_id),agent_code=f.mate_code,agent=f.mate_name,a.agent_id,ASSIGNED_BP=f.mate_code,agent1=f.mate_name,agent_code1=f.mate_code,stoppay=isnull(f.stoppay,0), VTEXT=dbo.fn_obj_desc1(11,a.channel_id),ZKDGRP=dbo.fn_obj_desc1(12,a.channel_dtl_id), dist1=f.BEZEI,dist2=f.CITY1,level1='', creater=d.zname,a.dst_id,e.mate_name,e.mate_id,BSTKD='',m.material_code,m.med_code,m.med_name,m.specifi,m.pdt_place,med_unit=dbo.fn_obj_desc(m.unit_id),m.type_id1,bat_cd='', z.ckd_amot,y.ckd_amot1,a.ckd_amot2,y.ckd_amot2a,h.ckd_amot3, qty=0,price=0,amot=cast(a.bod_amot as decimal(15,2)),amot1=0.00,amot2=0.00,price1=0,price10=0, type_id=0,type_id2=0,rate=0,rate1=0,fee=0,amot1a=0,cprice1=0,cprice2=0,fee_type_id=0 ,not_amot=cast(a.bod_amot-isnull(z.ckd_amot,0) as decimal(15,2)) ,amot5=cast(a.bod_amot as decimal(15,2)) from tb_bill a left join tb_bill_stadtl h on a.bod_id=h.bod_id left join tb_staff d on a.creat_by=d.sta_id left join tb_busimate e on a.dst_id=e.mate_id left join tb_busimate f on a.agent_id=f.mate_id left join tb_medicine m on a.med_id=m.med_id left join (select b.med_id,ckd_amot2a=sum(cast(b.amot as decimal(15,2))),  				ckd_amot1=sum(case a.bod_status_id when 1 then 1 else 0 end*cast(b.amot as decimal(15,2))) 			  from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.carry_dt>='2025-07-01' and a.bod_id=b.bod_id and b.type_id=36 group by b.med_id) y on y.med_id=a.bod_id left join (select b.med_id,ckd_amot =sum(cast(b.amot as decimal(15,2))) 			  from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.carry_dt>='2025-07-01' and a.bod_id=b.bod_id and b.type_id=36 				and exists (select 1 from tb_bill c,tb_bill_dtl d where c.bod_type_id=30 and c.bod_status_id=1 and c.bod_id=d.bod_id and d.med_id=a.bod_id)	group by b.med_id) z on z.med_id=a.bod_id where a.bod_type_id=36 and a.bod_status_id=1  and a.carry_dt>='2025-07-01' and a.carry_dt< dateadd(day,1,'2025-08-01')
 select agent_code1,agent1,ZKDGRP,dist1,dist1,bal0=0.00, ckd_amot=sum(ckd_amot),ckd_amot1=sum(ckd_amot1),ckd_amot2=sum(ckd_amot2),ckd_amot2a=sum(ckd_amot2a),ckd_amot3=sum(ckd_amot3), qty=sum(a.qty),amot=sum(amot),amot1=sum(amot1),amot2=sum(a.amot2), fee=sum(fee),amot1a=sum(amot1a),not_amot=sum(not_amot),amot5=sum(amot5) from (select a.rec_id,dtl_id=0,bod_id=0,a.carry_dt,bod_type_id=0,bod_type='分销采购',bod_cd=GBELN,bod_cd1=VBELN,bod_cd2='',bod_cd3=GBELN,bod_desc='',bod_desc1='',  broker_id=cast(ZSALESID_O as int),broker=ZSALESNAM_O, agent_code=a.ASSIGNED_BP,agent=case when i.rec_id>0 then dbo.fn_mate_name(i.agent_id1) else a.NAME_FIRST end,agent_id=c.mate_id,a.ASSIGNED_BP, agent1=case when i.rec_id>0 then i.agent else a.NAME_FIRST end, agent_code1=case when i.rec_id>0 then i.agent_code else a.ASSIGNED_BP end, stoppay=cast(0 as bit), a.VTEXT,a.ZKDGRP,dist1=ZZREGION, dist2=ZCITYNAME, level1=ZBEZEI, creater=ZTERNAM,dst_id=b.mate_id,mate_name=NAME1,b.mate_id,BSTKD,material_code=a.MATNR,med_code='',med_name=ARKTX,specifi=ZGG,pdt_place=ZSCQY,med_unit='',type_id1=0,bat_cd=CHARG, a.ckd_amot,ckd_amot1=e.amot,a.ckd_amot2,ckd_amot2a=d.amot,a.ckd_amot3, a.qty,price=cast(ZPR03 as decimal(15,4)),amot=cast(a.qty*cast(ZPR03 as decimal(15,4)) as decimal(15,2)),amot1=cast(a.amot1 as decimal(15,2)),amot2=cast(a.amot2 as decimal(15,2)),price1=cast(a.KONV as decimal(15,4)), price10=dbo.fn_getprice1a(ZREGIO,ZCITYNUM,a.MATNR,a.carry_dt), i.type_id,i.type_id2,i.rate,i.rate1,fee=cast(i.fee as decimal(15,4)),amot1a=cast(i.amot as decimal(15,4)),cprice1=i.price1,cprice2=i.price2,fee_type_id=0, not_amot=cast((isnull(i.amot,0)+isnull(i.fee,0))*a.qty-isnull(a.ckd_amot,0) as decimal(15,2)) ,amot5=cast(case when cast(a.KONV as decimal(15,4))=0 then 0 else cast(a.amot1/cast(a.KONV as decimal(15,4)) as decimal(15,2))*i.amot end as decimal(15,2)) from SAP_ZSD_015 a left join (select mate_id,mate_code,mate_name from tb_busimate where mate_type_id=2) b on a.NAME1=b.mate_name left join (select mate_id,mate_code,mate_name,district from tb_busimate where mate_type_id=4) c on c.mate_code=a.ASSIGNED_BP left join (select b.med_id,amot=sum(cast(b.amot as decimal(15,2))) from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.bod_id=b.bod_id group by b.med_id) d on d.med_id=a.rec_id left join (select b.med_id,amot=sum(cast(b.amot as decimal(15,2))) from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.bod_status_id=1 and a.bod_id=b.bod_id and b.type_id=0 group by b.med_id) e on e.med_id=a.rec_id left join (select c.rec_id,c.type_id,c.rate,c.rate1,c.price1,c.price2,c.type_id2,agent_id1=c.agent_id,agent_code1=f.mate_code,d.agent_id,d.amot,d.fee,agent_code=e.mate_code,agent=e.mate_name   from tb_busiframe3 c left join tb_busiframe3_dtl d on c.rec_id=d.rela_id left join tb_busimate e on d.agent_id=e.mate_id left join tb_busimate f on c.agent_id=f.mate_id) i  on i.rec_id=dbo.fn_getbusiframe3recid(a.VTWEG,a.KDGRP,b.mate_id,c.mate_id,a.MATNR,cast(a.KONV as decimal(15,4)),cast(ZPR03 as decimal(15,4)),a.carry_dt) where KDGRP not in ('10','19')  and (a.price>cast(ZPR03 as decimal(15,4)) or a.price=cast(ZPR03 as decimal(15,4)) and i.rec_id>0)  and a.carry_dt>='2025-07-01' and a.carry_dt< dateadd(day,1,'2025-08-01') union all select rec_id=case when h.rec_id is null then a.bod_id else h.rec_id end,dtl_id=a.bod_id,a.bod_id,a.carry_dt,a.bod_type_id,bod_type='应付记账',a.bod_cd,bod_cd1='',bod_cd2='',bod_cd3='',a.bod_desc,a.bod_desc1, a.broker_id,broker=dbo.fn_staff_name(a.broker_id),agent_code=f.mate_code,agent=f.mate_name,a.agent_id,ASSIGNED_BP=f.mate_code,agent1=f.mate_name,agent_code1=f.mate_code,stoppay=isnull(f.stoppay,0), VTEXT=dbo.fn_obj_desc1(11,a.channel_id),ZKDGRP=dbo.fn_obj_desc1(12,a.channel_dtl_id), dist1=f.BEZEI,dist2=f.CITY1,level1='', creater=d.zname,a.dst_id,e.mate_name,e.mate_id,BSTKD='',m.material_code,m.med_code,m.med_name,m.specifi,m.pdt_place,med_unit=dbo.fn_obj_desc(m.unit_id),m.type_id1,bat_cd='', z.ckd_amot,y.ckd_amot1,a.ckd_amot2,y.ckd_amot2a,h.ckd_amot3, qty=0,price=0,amot=cast(a.bod_amot as decimal(15,2)),amot1=0.00,amot2=0.00,price1=0,price10=0, type_id=0,type_id2=0,rate=0,rate1=0,fee=0,amot1a=0,cprice1=0,cprice2=0,fee_type_id=0 ,not_amot=cast(a.bod_amot-isnull(z.ckd_amot,0) as decimal(15,2)) ,amot5=cast(a.bod_amot as decimal(15,2)) from tb_bill a left join tb_bill_stadtl h on a.bod_id=h.bod_id left join tb_staff d on a.creat_by=d.sta_id left join tb_busimate e on a.dst_id=e.mate_id left join tb_busimate f on a.agent_id=f.mate_id left join tb_medicine m on a.med_id=m.med_id left join (select b.med_id,ckd_amot2a=sum(cast(b.amot as decimal(15,2))),  				ckd_amot1=sum(case a.bod_status_id when 1 then 1 else 0 end*cast(b.amot as decimal(15,2))) 			  from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.carry_dt>='2025-07-01' and a.bod_id=b.bod_id and b.type_id=36 group by b.med_id) y on y.med_id=a.bod_id left join (select b.med_id,ckd_amot =sum(cast(b.amot as decimal(15,2))) 			  from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.carry_dt>='2025-07-01' and a.bod_id=b.bod_id and b.type_id=36 				and exists (select 1 from tb_bill c,tb_bill_dtl d where c.bod_type_id=30 and c.bod_status_id=1 and c.bod_id=d.bod_id and d.med_id=a.bod_id)	group by b.med_id) z on z.med_id=a.bod_id where a.bod_type_id=36 and a.bod_status_id=1  and a.carry_dt>='2025-07-01' and a.carry_dt< dateadd(day,1,'2025-08-01') ) a group by agent_code1,agent1,ZKDGRP,dist1,dist1

 select agent_code1,agent1,ZKDGRP,dist1,dist1,bal0=0.00, ckd_amot=sum(ckd_amot),ckd_amot1=sum(ckd_amot1),ckd_amot2=sum(ckd_amot2),ckd_amot2a=sum(ckd_amot2a),ckd_amot3=sum(ckd_amot3), qty=sum(a.qty),amot=sum(amot),amot1=sum(amot1),amot2=sum(a.amot2), fee=sum(fee),amot1a=sum(amot1a),not_amot=sum(not_amot),amot5=sum(amot5) from (select a.rec_id,dtl_id=0,bod_id=0,a.carry_dt,bod_type_id=0,bod_type='分销采购',bod_cd=GBELN,bod_cd1=VBELN,bod_cd2='',bod_cd3=GBELN,bod_desc='',bod_desc1='',  broker_id=cast(ZSALESID_O as int),broker=ZSALESNAM_O, agent_code=a.ASSIGNED_BP,agent=case when i.rec_id>0 then dbo.fn_mate_name(i.agent_id1) else a.NAME_FIRST end,agent_id=c.mate_id,a.ASSIGNED_BP, agent1=case when i.rec_id>0 then i.agent else a.NAME_FIRST end, agent_code1=case when i.rec_id>0 then i.agent_code else a.ASSIGNED_BP end, stoppay=cast(0 as bit), a.VTEXT,a.ZKDGRP,dist1=ZZREGION, dist2=ZCITYNAME, level1=ZBEZEI, creater=ZTERNAM,dst_id=b.mate_id,mate_name=NAME1,b.mate_id,BSTKD,material_code=a.MATNR,med_code='',med_name=ARKTX,specifi=ZGG,pdt_place=ZSCQY,med_unit='',type_id1=0,bat_cd=CHARG, a.ckd_amot,ckd_amot1=e.amot,a.ckd_amot2,ckd_amot2a=d.amot,a.ckd_amot3, a.qty,price=cast(ZPR03 as decimal(15,4)),amot=cast(a.qty*cast(ZPR03 as decimal(15,4)) as decimal(15,2)),amot1=cast(a.amot1 as decimal(15,2)),amot2=cast(a.amot2 as decimal(15,2)),price1=cast(a.KONV as decimal(15,4)), price10=dbo.fn_getprice1a(ZREGIO,ZCITYNUM,a.MATNR,a.carry_dt), i.type_id,i.type_id2,i.rate,i.rate1,fee=cast(i.fee as decimal(15,4)),amot1a=cast(i.amot as decimal(15,4)),cprice1=i.price1,cprice2=i.price2,fee_type_id=0, not_amot=cast((isnull(i.amot,0)+isnull(i.fee,0))*a.qty-isnull(a.ckd_amot,0) as decimal(15,2)) ,amot5=cast(case when cast(a.KONV as decimal(15,4))=0 then 0 else cast(a.amot1/cast(a.KONV as decimal(15,4)) as decimal(15,2))*i.amot end as decimal(15,2)) from SAP_ZSD_015 a left join (select mate_id,mate_code,mate_name from tb_busimate where mate_type_id=2) b on a.NAME1=b.mate_name left join (select mate_id,mate_code,mate_name,district from tb_busimate where mate_type_id=4) c on c.mate_code=a.ASSIGNED_BP left join (select b.med_id,amot=sum(cast(b.amot as decimal(15,2))) from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.bod_id=b.bod_id group by b.med_id) d on d.med_id=a.rec_id left join (select b.med_id,amot=sum(cast(b.amot as decimal(15,2))) from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.bod_status_id=1 and a.bod_id=b.bod_id and b.type_id=0 group by b.med_id) e on e.med_id=a.rec_id left join (select c.rec_id,c.type_id,c.rate,c.rate1,c.price1,c.price2,c.type_id2,agent_id1=c.agent_id,agent_code1=f.mate_code,d.agent_id,d.amot,d.fee,agent_code=e.mate_code,agent=e.mate_name   from tb_busiframe3 c left join tb_busiframe3_dtl d on c.rec_id=d.rela_id left join tb_busimate e on d.agent_id=e.mate_id left join tb_busimate f on c.agent_id=f.mate_id) i  on i.rec_id=dbo.fn_getbusiframe3recid(a.VTWEG,a.KDGRP,b.mate_id,c.mate_id,a.MATNR,cast(a.KONV as decimal(15,4)),cast(ZPR03 as decimal(15,4)),a.carry_dt) where KDGRP not in ('10','19')  and (a.price>cast(ZPR03 as decimal(15,4)) or a.price=cast(ZPR03 as decimal(15,4)) and i.rec_id>0)  and a.carry_dt>='2025-07-01' and a.carry_dt< dateadd(day,1,'2025-08-01') union all select rec_id=case when h.rec_id is null then a.bod_id else h.rec_id end,dtl_id=a.bod_id,a.bod_id,a.carry_dt,a.bod_type_id,bod_type='应付记账',a.bod_cd,bod_cd1='',bod_cd2='',bod_cd3='',a.bod_desc,a.bod_desc1, a.broker_id,broker=dbo.fn_staff_name(a.broker_id),agent_code=f.mate_code,agent=f.mate_name,a.agent_id,ASSIGNED_BP=f.mate_code,agent1=f.mate_name,agent_code1=f.mate_code,stoppay=isnull(f.stoppay,0), VTEXT=dbo.fn_obj_desc1(11,a.channel_id),ZKDGRP=dbo.fn_obj_desc1(12,a.channel_dtl_id), dist1=f.BEZEI,dist2=f.CITY1,level1='', creater=d.zname,a.dst_id,e.mate_name,e.mate_id,BSTKD='',m.material_code,m.med_code,m.med_name,m.specifi,m.pdt_place,med_unit=dbo.fn_obj_desc(m.unit_id),m.type_id1,bat_cd='', z.ckd_amot,y.ckd_amot1,a.ckd_amot2,y.ckd_amot2a,h.ckd_amot3, qty=0,price=0,amot=cast(a.bod_amot as decimal(15,2)),amot1=0.00,amot2=0.00,price1=0,price10=0, type_id=0,type_id2=0,rate=0,rate1=0,fee=0,amot1a=0,cprice1=0,cprice2=0,fee_type_id=0 ,not_amot=cast(a.bod_amot-isnull(z.ckd_amot,0) as decimal(15,2)) ,amot5=cast(a.bod_amot as decimal(15,2)) from tb_bill a left join tb_bill_stadtl h on a.bod_id=h.bod_id left join tb_staff d on a.creat_by=d.sta_id left join tb_busimate e on a.dst_id=e.mate_id left join tb_busimate f on a.agent_id=f.mate_id left join tb_medicine m on a.med_id=m.med_id left join (select b.med_id,ckd_amot2a=sum(cast(b.amot as decimal(15,2))),  				ckd_amot1=sum(case a.bod_status_id when 1 then 1 else 0 end*cast(b.amot as decimal(15,2))) 			  from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.carry_dt>='2025-07-01' and a.bod_id=b.bod_id and b.type_id=36 group by b.med_id) y on y.med_id=a.bod_id left join (select b.med_id,ckd_amot =sum(cast(b.amot as decimal(15,2))) 			  from tb_bill a,tb_bill_dtl b where a.bod_type_id=37 and a.carry_dt>='2025-07-01' and a.bod_id=b.bod_id and b.type_id=36 				and exists (select 1 from tb_bill c,tb_bill_dtl d where c.bod_type_id=30 and c.bod_status_id=1 and c.bod_id=d.bod_id and d.med_id=a.bod_id)	group by b.med_id) z on z.med_id=a.bod_id where a.bod_type_id=36 and a.bod_status_id=1  and a.carry_dt>='2025-07-01' and a.carry_dt< dateadd(day,1,'2025-08-01') ) a group by agent_code1,agent1,ZKDGRP,dist1,dist1


 设置业务员、设置业务负责人，列表与明细的“个体开户”出需要删除


select top 10 b.dtl_id,a.bod_id,a.bod_cd,a.bod_status_id,d.med_code,d.material_code,d.material_code1,d.med_name,d.specifi,d.pdt_place,d.qtyperpack, 
cdistrict=dbo.fn_getdistrict1(j.district), med_unit=dbo.fn_obj_desc(d.unit_id),a.bod_desc,customer=case when j.mate_type_id=1 then j.mate_name else '' end,j.mate_type_id,mate_name=dbo.fn_mate_name(a.src_id), 
b.channel_id,channel=dbo.fn_obj_desc1(11,b.channel_id),b.channel_dtl_id,channel_dtl=dbo.fn_obj_desc1(12,b.channel_dtl_id), 
level1=k.VKBUR_TXT,level2=k.VKGRP_TXT,level3=k.ZPLOT_T, k.VKGRP,k.VKGRP_TXT,k.PARTNER,leader=k.BU_SORT1,a.data_type_id,data_type=dbo.fn_obj_desc(a.data_type_id), mate_id1=a.src_id,mate_id2=a.dst_id,mate_id3=0,mate_id4=0,mate_id5=0, mate_name1='', mate_name2='', mate_name3='', mate_name4='', mate_name5='', carry_dt=cast(convert(char(10),a.carry_dt,20) as datetime),a.creat_dt, a.busi_type,b.price,b.price3,b.qty,b.discount, amot=cast(b.price*b.qty as decimal(15,2)), cost=b.cost*b.qty,profit=(b.amot-b.cost*b.qty),prate=case b.amot when 0 then 0 else (b.amot-b.cost*b.qty)/b.amot*100 end, b.bat_cd,broker=dbo.fn_staff_name(b.sta_id),creater=dbo.fn_staff_name(a.creat_by),checker=dbo.fn_staff_name(a.check_by) 
from tb_bill a 
inner join tb_bill_dtl b on a.bod_id=b.bod_id 
inner join tb_medicine d on b.med_id=d.med_id 
left join tb_busimate j on a.dst_id=j.mate_id 
left join SAP_ZSD_BUS k on k.rec_id=dbo.fn_getSAP_ZSD_BUSrecid(b.channel_id,b.channel_dtl_id,j.district,j.mate_code,d.material_code1,a.carry_dt) 
where a.bod_type_id=2   and a.bod_status_id in (0,1)  and a.cate_id=1  
	and a.bod_cd='00005466' --00004698'
and a.carry_dt>= '2025-01-01' and a.carry_dt< dateadd(day,1,'2025-01-31')


  --      if Trim(dxLookupTreeView1.text)<>'' then commandtext:=commandtext+' and j.district like '''+dm.district.fieldbyname('code').asstring+'%'''

  select * from (select top 10 * from tb_medicine) a


select top 10 * from SAP_ZSD_015 where VBELN in ('22578') --'22632','22666')


select * from (
select top 100 * from ( select tmprow=row_number()over(order by a.creat_dt,b.dtl_id), b.dtl_id,a.bod_id,a.bod_type_id,a.bod_cd,a.stock_id,stock_name=dbo.fn_stock_name(a.stock_id),site_code=substring(d.site_code,1,3),d.med_code,d.med_name,d.specifi,d.pdt_place,d.original, cdistrict=dbo.fn_getdistrict(district),medclass_type=dbo.fn_obj_desc(d.medclass_type_id),fcateid=case when d.catlog_id in (23,24) then 'ÒûÆ¬' else 'ÆÕÒ©' end, med_unit=dbo.fn_obj_desc(d.unit_id),invo_cd='',invocddt=dbo.fn_getinvocddt(a.bod_id),customer=f.mate_name,f.deputy,supplier=dbo.fn_mate_name(i.mate_id), a.dst_id,a.team_id,team_name=dbo.fn_team_name(a.team_id),department=dbo.fn_obj_desc(s.dept_id),a.bod_desc, purchaser=dbo.fn_staff_name(d.purchase_by),busitype=dbo.fn_busi_type(f.busi_type_id), creat_dt=cast(convert(char(10),a.creat_dt,20) as datetime), cash_dt=cast(convert(char(10),a.cash_dt,20) as datetime), check_dt=cast(convert(char(10),a.check_dt,20) as datetime), cash_by,casher=dbo.fn_staff_name(cash_by),storage_by,storager=dbo.fn_staff_name(storage_by),recheck_by,rechecker=dbo.fn_staff_name(recheck_by),a.check_by,checker=dbo.fn_staff_name(a.check_by), bod_type=case a.bod_type_id when 2 then 'ÏúÊÛ' when 5 then case a.src_id when 2 then '³åµ¥' else 'ÍË»õ' end when 6 then 'ÍË²¹' end, cbusi_type=case a.busi_type when 1 then 'A' when 2 then 'B' when 3 then 'C' when 4 then 'D' when 5 then 'µ÷²¦' end, price=case a.bod_type_id when 6 then -1 else 1 end*b.price, qty=case a.bod_type_id when 5 then -1 else 1 end*b.qty, packqty=case a.bod_type_id when 5 then -1 else 1 end*case isnull(d.qtyperpack,0) when 0 then 0 else cast((b.qty-b.qty%d.qtyperpack)/d.qtyperpack as decimal(15,0)) end, remqty =case a.bod_type_id when 5 then -1 else 1 end*case isnull(d.qtyperpack,0) when 0 then 0 else b.qty%d.qtyperpack end, rela_value=cast(case a.bod_type_id when 6 then -1 else 1 end*b.rela_value as decimal(15,4)), amot= case a.bod_type_id when 2 then 1 else -1 end*b.amot, cost=round(case a.bod_type_id when 2 then 1 when 5 then -1 else 0 end*case bod_type_id when 6 then b.price else b.cost end*b.qty,2), amot1=cast(case a.bod_type_id when 2 then 1 else -1 end*b.rela_value*b.qty as decimal(15,2)), ckd_amot1=cast(case a.bod_type_id when 2 then 1 else -1 end*b.rela_value*b.qty*a.ckd_amot1/a.bod_amot as decimal(15,2)), not_amot1=cast(case a.bod_type_id when 2 then 1 else -1 end*b.rela_value*b.qty*(1-a.ckd_amot1/a.bod_amot) as decimal(15,2)), profit=case a.bod_type_id when 2 then 1 else -1 end*(b.price-case a.bod_type_id when 6 then 0 else isnull(b.cost,0) end)*b.qty, prate=case when b.amot=0 then 0 else case a.bod_type_id when 2 then 1 when 5 then -1 when 6 then 0 end*(b.price-case a.bod_type_id when 6 then 0 else isnull(b.cost,0) end)*b.qty/b.amot*100 end, b.bat_cd,i.valid_dt,i.pdt_dt,i.price1,i.price2,i.cangku,i.huowei,broker=s.zname,leader=dbo.fn_staff_name(s.lead_id),creater=dbo.fn_staff_name(a.creat_by), csettle_type=case a.settle_type when 1 then 'ÏÖ½ð' when 2 then 'Ö§Æ±' when 3 then 'ÉÞÇ·' end,	dist1=dbo.fn_getdistrictlevel (f.district,1),	dist2=dbo.fn_getdistrictlevel (f.district,2),	dist3=dbo.fn_getdistrictlevel (f.district,3) from tb_bill a,tb_bill_dtl b,tb_medicine d,tb_busimate f,tb_medstock_bat i,tb_staff s where a.bod_type_id in (2,5,6)  and a.bod_status_id in (1,3)   and a.check_dt>= '2025-08-05' and a.check_dt< dateadd(day,1,'2025-08-05')  and a.comp_id=1 and not exists (select 1 from tb_stock s where a.stock_id=s.stock_id and s.stop_yn=1)  and a.dst_id=f.mate_id and isnull(f.mate_hide,0)=0 and (a.team_id=131 or a.team_id in (select team_id from tb_sysrule where type_id=1 and sta_id=232))  and b.bod_id=a.bod_id and b.med_id=d.med_id and a.broker_id*=s.sta_id  and isnull(d.med_hide,0)=0 and b.rela_id*=i.rec_id ) t where tmprow>100*0
) a

declare @tab table (line_no varchar(3),f1 varchar(100),f2 varchar(100),f3 varchar(100),f4 varchar(100),f5 varchar(100),f6 varchar(100),f7 varchar(100),f8 varchar(100),f9 varchar(100),f10 varchar(100),f11 varchar(100)) 
insert into @tab (line_no,f1,f2,f3,f4,f5,f6,f7,f8,f9,f10,f11) 
select 2,'商业','分销','安徽省','合肥市','国药控股安徽有限公司','1000010000','28.02','12.0486','1','2025-1-1','' union all  select 3,'商业','分销','北京市','北京市','北京九州通医药有限公司','1000002401','22.05','9.9225','1','2025-1-1','' union all  select 4,'商业','分销','北京市','北京市','北京九州通医药有限公司','1000016901','8.5','0.5','1','2025-1-1','' union all  select 5,'商业','分销','北京市','北京市','北京九州通医药有限公司','1000043400','44.1','19.845','1','2025-1-1','' union all  select 6,'商业','分销','北京市','北京市','北京科园信海医药经营有限公司','1000010000','28.02','12.609','1','2025-1-1','' union all  select 7,'商业','分销','北京市','北京市','国药集团药业股份有限公司','1000010000','28.02','12.609','1','2025-1-1','' union all  select 8,'商业','分销','北京市','北京市','国药集团药业股份有限公司','1000018901','8.27','2.481','1','2025-1-1','' union all  select 9,'商业','分销','北京市','北京市','华润医药商业集团有限公司','1000010000','28.02','12.609','1','2025-1-1','' union all  select 10,'商业','分销','甘肃省','兰州市','国药控股甘肃有限公司','1000016700','29.88','5','1','2025-1-1','' union all  select 11,'商业','分销','甘肃省','兰州市','国药控股甘肃有限公司','1000016701','29.88','5','1','2025-1-1','' union all  select 12,'商业','分销','广东省','广州市','广东通用医药有限公司','1000010000','28.02','11.208','1','2025-1-1','' union all  select 13,'商业','分销','广东省','广州市','广东通用医药有限公司','1000020501','4.23','1.3536','1','2025-1-1','' union all  select 14,'商业','分销','广东省','广州市','广州国盈医药有限公司','1000008100','45','21.6','1','2025-1-1','' union all  select 15,'商业','分销','广东省','广州市','广州国盈医药有限公司','1000011900','39.53','18.5791','1','2025-1-1','' union all  select 16,'商业','分销','广东省','广州市','广州国盈医药有限公司','1000016701','38.5','5','1','2025-1-1','' union all  select 17,'商业','分销','广东省','广州市','广州国盈医药有限公司','1000017002','78','35.1','1','2025-1-1','' union all  select 18,'商业','分销','广东省','广州市','广州国盈医药有限公司','1000017200','39','17.55','1','2025-1-1','' union all  select 19,'商业','分销','广东省','广州市','广州国盈医药有限公司','1000018200','29.7','13.365','1','2025-1-1','' union all  select 20,'商业','分销','广东省','广州市','广州国盈医药有限公司','1000019102','79.76','35.892','1','2025-1-1','' union all  select 21,'商业','分销','广东省','广州市','广州国盈医药有限公司','1000019500','59.29','27.8663','1','2025-1-1','' union all  select 22,'商业','分销','广东省','广州市','广州国盈医药有限公司','1000020201','16.33','6.8586','1','2025-1-1','' union all  select 23,'商业','分销','广东省','广州市','广州国盈医药有限公司','1000020400','27.58','13.2384','1','2025-1-1','' union all  select 24,'商业','分销','广东省','广州市','广州医药股份有限公司','1000002100','33','15.84','1','2025-1-1','' union all  select 25,'商业','分销','广东省','广州市','广州医药股份有限公司','1000004100','36.3','16.335','1','2025-1-1','' union all  select 26,'商业','分销','广东省','广州市','广州医药股份有限公司','1000004101','36.3','16.335','1','2025-1-1','' union all  select 27,'商业','分销','广东省','广州市','广州医药股份有限公司','1000004900','59.4','27.324','1','2025-1-1','' union all  select 28,'商业','分销','广东省','广州市','广州医药股份有限公司','1000005600','22.22','7.9992','1','2025-1-1','' union all  select 29,'商业','分销','广东省','广州市','广州医药股份有限公司','1000009800','18.96','7.584','1','2025-1-1','' union all  select 30,'商业','分销','广东省','广州市','广州医药股份有限公司','1000010000','28.02','11.208','1','2025-1-1','' union all  select 31,'商业','分销','广东省','广州市','广州医药股份有限公司','1000011400','49.8','23.904','1','2025-1-1','' union all  select 32,'商业','分销','广东省','广州市','广州医药股份有限公司','1000013000','22','10.56','1','2025-1-1','' union all  select 33,'商业','分销','广东省','广州市','广州医药股份有限公司','1000013100','44','22','1','2025-1-1','' union all  select 34,'商业','分销','广东省','广州市','广州医药股份有限公司','1000015901','3.33','0.666','1','2025-1-1','' union all  select 35,'商业','分销','广东省','广州市','广州医药股份有限公司','1000016200','59.2','26.64','1','2025-1-1','' union all  select 36,'商业','分销','广东省','广州市','广州医药股份有限公司','1000016700','38.5','5','1','2025-1-1','' union all  select 37,'商业','分销','广东省','广州市','广州医药股份有限公司','1000016701','38.5','5','1','2025-1-1','' union all  select 38,'商业','分销','广东省','广州市','广州医药股份有限公司','1000016901','8.5','0.5','1','2025-1-1','' union all  select 39,'商业','分销','广东省','广州市','广州医药股份有限公司','1000017400','78','35.1','1','2025-1-1','' union all  select 40,'商业','分销','广东省','广州市','广州医药股份有限公司','1000017800','49.5','23.76','1','2025-1-1','' union all  select 41,'商业','分销','广东省','广州市','广州医药股份有限公司','1000018200','29.7','13.365','1','2025-1-1','' union all  select 42,'商业','分销','广东省','广州市','广州医药股份有限公司','1000019202','46.91','21.1095','1','2025-1-1','' union all  select 43,'商业','分销','广东省','广州市','广州医药股份有限公司','1000019600','45','21.6','1','2025-1-1','' union all  select 44,'商业','分销','广东省','广州市','广州医药股份有限公司','1000019701','0.83','0.083','1','2025-1-1','' union all  select 45,'商业','分销','广东省','广州市','广州医药股份有限公司','1000019702','0.83','0.083','1','2025-1-1','' union all  select 46,'商业','分销','广东省','广州市','广州医药股份有限公司','1000020201','16.33','6.8586','1','2025-1-1','' union all  select 47,'商业','分销','广东省','广州市','广州医药股份有限公司','1000027700','22.68','8.1648','1','2025-1-1','' union all  select 48,'商业','分销','广东省','广州市','国药控股广东恒兴有限公司','1000010300','15.95','3.53','1','2025-1-1','连锁KA' union all  select 49,'商业','分销','广东省','广州市','国药控股广东恒兴有限公司','1000016200','59.2','26.64','1','2025-1-1','连锁KA' union all  select 50,'商业','分销','广东省','广州市','国药控股广东恒兴有限公司','1000016901','8.5','0.5','1','2025-1-1','连锁KA' union all  select 51,'商业','分销','广东省','广州市','国药控股广东恒兴有限公司','1000025800','11','2','1','2025-1-1','连锁KA' union all  select 52,'商业','分销','广东省','广州市','国药控股广州有限公司','1000005600','22.22','7.9992','1','2025-1-1','' union all  select 53,'商业','分销','广东省','广州市','国药控股广州有限公司','1000008000','30','14.4','1','2025-1-1','' union all  select 54,'商业','分销','广东省','广州市','国药控股广州有限公司','1000008600','12.5','1.875','1','2025-1-1','' union all  select 55,'商业','分销','广东省','广州市','国药控股广州有限公司','1000011500','45','21.6','1','2025-1-1','' union all  select 56,'商业','分销','广东省','广州市','国药控股广州有限公司','1000011900','39.53','18.5791','1','2025-1-1','' union all  select 57,'商业','分销','广东省','广州市','国药控股广州有限公司','1000012500','30','14.4','1','2025-1-1','' union all  select 58,'商业','分销','广东省','广州市','国药控股广州有限公司','1000016200','59.2','26.64','1','2025-1-1','' union all  select 59,'商业','分销','广东省','广州市','国药控股广州有限公司','1000016700','38.5','5','1','2025-1-1','' union all  select 60,'商业','分销','广东省','广州市','国药控股广州有限公司','1000016701','38.5','5','1','2025-1-1','' union all  select 61,'商业','分销','广东省','广州市','国药控股广州有限公司','1000017002','78','35.1','1','2025-1-1','' union all  select 62,'商业','分销','广东省','广州市','国药控股广州有限公司','1000017200','39','17.55','1','2025-1-1','' union all  select 63,'商业','分销','广东省','广州市','国药控股广州有限公司','1000017500','47.88','22.9824','1','2025-1-1','' union all  select 64,'商业','分销','广东省','广州市','国药控股广州有限公司','1000017800','49.5','23.76','1','2025-1-1','' union all  select 65,'商业','分销','广东省','广州市','国药控股广州有限公司','1000018000','1.88','0.188','1','2025-1-1','' union all  select 66,'商业','分销','广东省','广州市','国药控股广州有限公司','1000018200','29.7','13.365','1','2025-1-1','' union all  select 67,'商业','分销','广东省','广州市','国药控股广州有限公司','1000018301','0.36','0.036','1','2025-1-1','' union all  select 68,'商业','分销','广东省','广州市','国药控股广州有限公司','1000018400','33.05','14.8725','1','2025-1-1','' union all  select 69,'商业','分销','广东省','广州市','国药控股广州有限公司','1000019102','79.76','35.892','1','2025-1-1','' union all  select 70,'商业','分销','广东省','广州市','国药控股广州有限公司','1000019202','46.91','21.1095','1','2025-1-1','' union all  select 71,'商业','分销','广东省','广州市','国药控股广州有限公司','1000020101','17.85','8.925','1','2025-1-1','' union all  select 72,'商业','分销','广东省','广州市','国药控股广州有限公司','1000020201','16.33','6.8586','1','2025-1-1','' union all  select 73,'商业','分销','广东省','广州市','国药控股广州有限公司','1000020400','27.58','13.2384','1','2025-1-1','' union all  select 74,'商业','分销','广东省','广州市','国药控股广州有限公司','1000020501','4.23','1.3536','1','2025-1-1','' union all  select 75,'商业','分销','广东省','广州市','国药控股广州有限公司','1000027700','22.68','8.1648','1','2025-1-1','' union all  select 76,'商业','分销','广东省','广州市','华润广东医药有限公司','1000010000','28.02','11.208','1','2025-1-1','' union all  select 77,'商业','分销','广东省','广州市','华润广东医药有限公司','1000016700','38.5','5','1','2025-1-1','' union all  select 78,'商业','分销','广东省','广州市','华润广东医药有限公司','1000016701','38.5','5','1','2025-1-1','' union all  select 79,'商业','分销','广东省','广州市','华润广东医药有限公司','1000019701','0.83','0.083','1','2025-1-1','' union all  select 80,'商业','分销','广东省','广州市','上药控股广东有限公司','1000016700','38.5','5','1','2025-1-1','' union all  select 81,'商业','分销','广东省','广州市','上药控股广东有限公司','1000016901','8.5','0.5','1','2025-1-1','' union all  select 82,'商业','分销','广东省','广州市','上药控股广东有限公司','1000018701','27.77','11.6634','1','2025-1-1','' union all  select 83,'商业','分销','广东省','深圳市','国药集团一致药业股份有限公司','1000010000','28.02','11.208','1','2025-1-1','' union all  select 84,'商业','分销','广东省','深圳市','国药集团一致药业股份有限公司','1000016700','38.5','5','1','2025-1-1','' union all  select 85,'商业','分销','广东省','深圳市','国药集团一致药业股份有限公司','1000017501','47.88','22.9824','1','2025-1-1','' union all  select 86,'商业','分销','广东省','深圳市','国药集团一致药业股份有限公司','1000018000','1.88','0.188','1','2025-1-1','' union all  select 87,'商业','分销','广东省','深圳市','国药集团一致药业股份有限公司','1000019401','173.47','42','1','2025-1-1','连锁KA' union all  select 88,'商业','分销','广东省','深圳市','国药集团一致药业股份有限公司','1000025900','13.8','0.8','1','2025-1-1','连锁KA' union all  select 89,'商业','分销','广东省','深圳市','国药控股深圳延风有限公司','1000004900','59.4','27.324','1','2025-1-1','' union all  select 90,'商业','分销','广东省','深圳市','国药控股深圳延风有限公司','1000010000','28.02','11.208','1','2025-1-1','' union all  select 91,'商业','分销','广西壮族自治区','南宁市','广西柳药集团股份有限公司','1000001400','1.78','0.178','1','2025-1-1','' union all  select 92,'商业','分销','海南省','海口市','国药控股海南有限公司','1000010000','28.02','12.0486','1','2025-1-1','' union all  select 93,'商业','分销','河北省','石家庄市','国药乐仁堂医药有限公司','1000008200','0.78','0.078','1','2025-1-1','' union all  select 94,'商业','分销','河北省','石家庄市','国药乐仁堂医药有限公司','1000009900','25.87','4.9','1','2025-1-1','连锁KA' union all  select 95,'商业','分销','河南省','郑州市','国药控股河南股份有限公司','1000010000','28.02','12.0486','1','2025-1-1','' union all  select 96,'商业','分销','河南省','郑州市','华润河南医药有限公司','1000002401','22.05','9.9225','1','2025-1-1','' union all  select 97,'商业','分销','河南省','郑州市','华润河南医药有限公司','1000010000','28.02','12.0486','1','2025-1-1','' union all  select 98,'商业','分销','河南省','郑州市','华润河南医药有限公司','1000016200','59.2','29.6','1','2025-1-1','' union all  select 99,'商业','分销','河南省','郑州市','华润河南医药有限公司','1000017400','78','39','1','2025-1-1','' union all  select 100,'商业','分销','河南省','郑州市','华润河南医药有限公司','1000043400','44.1','19.845','1','2025-1-1','' union all  select 101,'商业','分销','湖北省','武汉市','国药控股湖北有限公司','1000018000','1.88','0.188','1','2025-1-1','' union all  select 102,'商业','分销','湖北省','武汉市','华润湖北医药有限公司','1000008200','0.78','0.078','1','2025-1-1','' union all  select 103,'商业','分销','湖北省','武汉市','华润湖北医药有限公司','1000016701','29.88','5','1','2025-1-1','' union all  select 104,'商业','分销','湖南省','长沙市','国药控股湖南有限公司','1000010000','28.02','12.0486','1','2025-1-1','' union all  select 105,'商业','分销','湖南省','长沙市','国药控股湖南有限公司','1000010100','36.97','15.8971','1','2025-1-1','' union all  select 106,'商业','分销','吉林省','长春市','国药控股吉林有限公司','1000010000','28.02','12.0486','1','2025-1-1','' union all  select 107,'商业','分销','江苏省','南京市','国药控股江苏有限公司','1000008200','0.78','0.078','1','2025-1-1','' union all  select 108,'商业','分销','江苏省','无锡市','国药控股江阴华宏医药有限公司','1000008200','0.78','0.078','1','2025-1-1','' union all  select 109,'商业','分销','江西省','南昌市','国药控股江西有限公司','1000010000','28.02','12.0486','1','2025-1-1','' union all  select 110,'商业','分销','江西省','南昌市','江西汇仁医药贸易有限公司','1000008800','4.5','0.4','1','2025-1-1','' union all  select 111,'商业','分销','江西省','南昌市','江西南华（通用）医药有限公司','1000016700','29.88','5','1','2025-1-1','' union all  select 112,'商业','分销','辽宁省','沈阳市','大连奥森医药有限公司','1000010000','28.02','12.0486','1','2025-1-1','' union all  select 113,'商业','分销','辽宁省','沈阳市','华润辽宁医药有限公司','1000019600','45','0.5','1','2025-1-1','' union all  select 114,'商业','分销','内蒙古自治区','呼和浩特市','华润内蒙古医药有限公司','1000015901','3.33','0.666','1','2025-1-1','' union all  select 115,'商业','分销','内蒙古自治区','呼和浩特市','内蒙古九州通医药有限公司','1000016701','29.88','5','1','2025-1-1','' union all  select 116,'商业','分销','宁夏回族自治区','银川市','国药控股宁夏有限公司','1000008200','0.78','0.078','1','2025-1-1','' union all  select 117,'商业','分销','宁夏回族自治区','银川市','国药控股宁夏有限公司','1000016901','8.5','0.5','1','2025-1-1','' union all  select 118,'商业','分销','山东省','济南市','国药控股山东有限公司','1000002201','58','27.84','1','2025-1-1','' union all  select 119,'商业','分销','山东省','济南市','国药控股山东有限公司','1000010000','28.02','12.0486','1','2025-1-1','' union all  select 120,'商业','分销','山东省','济南市','华润山东医药有限公司','1000010000','28.02','12.0486','1','2025-1-1','' union all  select 121,'商业','分销','山东省','济南市','华润山东医药有限公司','1000019500','59.29','26.6805','1','2025-1-1','' union all  select 122,'商业','分销','陕西省','西安市','国药控股陕西有限公司','1000016700','29.88','5','1','2025-1-1','' union all  select 123,'商业','分销','上海市','上海市','国药控股股份有限公司','1000010000','28.02','12.609','1','2025-1-1','' union all  select 124,'商业','分销','上海市','上海市','国药控股股份有限公司','1000016700','19.93','2.9895','1','2025-1-1','' union all  select 125,'商业','分销','上海市','上海市','国药控股股份有限公司','1000016701','19.93','2.9895','1','2025-1-1','' union all  select 126,'商业','分销','上海市','上海市','华润国邦（上海）医药有限公司','1000009800','18.96','8.1528','1','2025-1-1','' union all  select 127,'商业','分销','上海市','上海市','华润国邦（上海）医药有限公司','1000018402','33.05','18.17','1','2025-1-1','' union all  select 128,'商业','分销','上海市','上海市','上海和记黄埔医药销售有限公司','1000010000','28.02','12.609','1','2025-1-1','' union all  select 129,'商业','分销','上海市','上海市','上海美罗医药有限公司','1000043400','44.1','19.845','1','2025-1-1','' union all  select 130,'商业','分销','上海市','上海市','上药康德乐罗达（上海）医药有限公司','1000002000','78','45.24','1','2025-1-1','' union all  select 131,'商业','分销','上海市','上海市','上药康德乐罗达（上海）医药有限公司','1000009800','18.96','8.1528','1','2025-1-1','' union all  select 132,'商业','分销','上海市','上海市','上药康德乐罗达（上海）医药有限公司','1000018201','49.3','27.115','1','2025-1-1','' union all  select 133,'商业','分销','四川省','成都市','国药控股成都医药有限公司','1000016901','8.5','0.5','1','2025-1-1','连锁KA' union all  select 134,'商业','分销','四川省','成都市','国药控股四川医药股份有限公司','1000010000','28.02','12.0486','1','2025-1-1','' union all  select 135,'商业','分销','四川省','成都市','上药控股四川有限公司','1000019701','0.83','0.083','1','2025-1-1','' union all  select 136,'商业','分销','四川省','成都市','四川鹭燕医药有限公司','1000010000','28.02','12.0486','1','2025-1-1','' union all  select 137,'商业','分销','天津市','天津市','国药控股天津有限公司','1000016700','29.88','5','1','2025-1-1','' union all  select 138,'商业','分销','天津市','天津市','华润天津医药有限公司','1000001400','1.78','0.178','1','2025-1-1','' union all  select 139,'商业','分销','天津市','天津市','华润天津医药有限公司','1000016700','29.88','5','1','2025-1-1','' union all  select 140,'商业','分销','天津市','天津市','津药太平医药有限公司','1000016700','29.88','5','1','2025-1-1','' union all  select 141,'商业','分销','新疆维吾尔自治区','乌鲁木齐市','国药集团新疆新特药业有限公司','1000019702','0.83','0.083','1','2025-1-1','' union all  select 142,'商业','分销','新疆维吾尔自治区','乌鲁木齐市','新疆九州通医药有限公司','1000010000','28.02','12.0486','1','2025-1-1','' union all  select 143,'商业','分销','云南省','昆明市','国药控股云南有限公司','1000010000','28.02','12.0486','1','2025-1-1','' union all  select 144,'商业','分销','云南省','昆明市','国药控股云南有限公司','1000013300','76.6','11.49','1','2025-1-1','' union all  select 145,'商业','分销','云南省','昆明市','国药控股云南有限公司','1000019702','0.83','0.083','1','2025-1-1','' union all  select 146,'商业','分销','云南省','昆明市','云南省医药有限公司','1000010000','28.02','12.0486','1','2025-1-1','' union all  select 147,'商业','分销','浙江省','杭州市','华东医药股份有限公司','1000010000','28.02','11.208','1','2025-1-1','' union all  select 148,'商业','分销','浙江省','杭州市','上药控股温州有限公司','1000010000','28.02','11.208','1','2025-1-1','' union all  select 149,'商业','分销','浙江省','杭州市','浙江英特药业有限责任公司','1000010000','28.02','11.208','1','2025-1-1','' union all  select 150,'商业','分销','浙江省','杭州市','重庆医药（集团）股份有限公司浙江分公司','1000010000','28.02','11.208','1','2025-1-1','' union all  select 151,'商业','分销','重庆市','重庆市','重庆医药集团药特分有限责任公司','1000010000','28.02','12.0486','1','2025-1-1','' 

select top 5 * from ( 
select top 5 info='第'+line_no+'行 无渠道名称或数据无效' from @tab a where f1='' or not exists (select 1 from tb_object b where b.obj_type_id=11 and b.zdesc=a.f1) 
union all select top 5 '第'+line_no+'行无 子渠道名称或数据无效' from @tab a where f2='' or not exists (select 1 from tb_object b where b.obj_type_id=12 and b.zdesc=a.f2) 
union all select top 5 '第'+line_no+'行无 省份城市或数据无效' from @tab a where f3='' or not exists (select 1 from tb_district b where (b.prov_name=f3 and (b.city_name=f4 or b.county_name=f4)) 
union all select top 5 '第'+line_no+'行无 商业公司或数据无效' from @tab a where f5='' or not exists (select 1 from tb_busimate b where b.mate_type_id=2 and b.mate_name=f5) 
union all select top 5 '第'+line_no+'行无 物料编码或数据无效' from @tab a where f6='' or not exists (select 1 from tb_medicine b where b.material_code=f6) 
union all select top 5 '第'+line_no+'行无 中标价/开票价或数据无效' from @tab where f7='' or try_cast(f7 as decimal(15,4)) is null 
union all select top 5 '第'+line_no+'行无 金额或数据无效' from @tab where f8='' or try_cast(f8 as decimal(15,4)) is null 
union all select top 5 '第'+line_no+'行无 定价单位或数据无效' from @tab where f8='' 
union all select top 5 '第'+line_no+'行无 启用日期或数据无效' from @tab where f9='' or try_cast(f9 as datetime) is null 
order by line_no
) a

